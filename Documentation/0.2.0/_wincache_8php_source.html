<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PEAR2_Cache_SHM: PEAR2/Cache/SHM/Adapter/Wincache.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PEAR2_Cache_SHM
   &#160;<span id="projectnumber">0.2.0</span>
   </div>
   <div id="projectbrief">Wrapper for shared memory and locking functionality across different extensions.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_wincache_8php_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Wincache.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Wrapper for shared memory and locking functionality across different extensions.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Allows you to share data across requests as long as the PHP process is running. One of APC or WinCache is required to accomplish this, with other extensions being potentially pluggable as adapters.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * PHP version 5</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * @category  Caching</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * @package   PEAR2_Cache_SHM</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * @author    Vasil Rangelov &lt;boen.robot@gmail.com&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * @copyright 2011 Vasil Rangelov</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * @license   http://www.gnu.org/copyleft/lesser.html LGPL License 2.1</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * @version   0.2.0</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * @link      http://pear2.php.net/PEAR2_Cache_SHM</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> */</span><span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * The namespace declaration.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter.html">PEAR2\Cache\SHM\Adapter</a>;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Throws exceptions from this namespace, and extends from this class.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;use <a class="code" href="namespace_p_e_a_r2_1_1_cache_1_1_s_h_m.html">PEAR2\Cache\SHM</a>;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * {@link Wincache::getIterator()} returns this object.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;use <a class="code" href="namespace_array_object.html">ArrayObject</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * Shared memory adapter for the WinCache extension.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * @category Caching</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * @package  PEAR2_Cache_SHM</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * @author   Vasil Rangelov &lt;boen.robot@gmail.com&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * @license  http://www.gnu.org/copyleft/lesser.html LGPL License 2.1</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * @link     http://pear2.php.net/PEAR2_Cache_SHM</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html">   43</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html">Wincache</a> <span class="keyword">extends</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m.html">SHM</a></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{<span class="comment"></span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">     * ID of the current storage.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">     * @var string</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keyword">protected</span> $persistentId;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">     * List of persistent IDs.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">     * A list of persistent IDs within the current request (as keys) with an int</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">     * (as a value) specifying the number of instances in the current request.</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">     * Used as an attempt to ensure implicit lock releases on destruction.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">     * @var array</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">protected</span> <span class="keyword">static</span> $requestInstances = array();</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">     * Array of lock names obtained during the current request.</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">     * @var array</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">protected</span> <span class="keyword">static</span> $locksBackup = array();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">     * Creates a new shared memory storage.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">     * Establishes a separate persistent storage.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">     * @param string $persistentId The ID for the storage. The storage will be</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">     *     reused if it exists, or created if it doesn&#39;t exist. Data and locks</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">     *     are namespaced by this ID.</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a4d9651f3a7676b4ef084194bc310f7fb">   79</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a4d9651f3a7676b4ef084194bc310f7fb">__construct</a>($persistentId)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        $this-&gt;persistentId</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            = static::encodeLockName(__CLASS__ . <span class="charliteral">&#39; &#39;</span> . $persistentId) . <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">if</span> (isset(static::$requestInstances[$this-&gt;persistentId])) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            static::$requestInstances[$this-&gt;persistentId]++;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            static::$requestInstances[$this-&gt;persistentId] = 1;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            static::$locksBackup[$this-&gt;persistentId] = array();</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">     * Encodes a lock name</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">     * Encodes a lock name, so that it can be properly obtained. The scheme used</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">     * is a subset of URL encoding, with only the &quot;%&quot; and &quot;\&quot; characters being</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">     * escaped. The encoding itself is necessary, since lock names can&#39;t contain</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">     * the &quot;\&quot; character.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">     * @param string $name The lock name to encode.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">     * @return string The encoded name.</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">     * @link http://msdn.microsoft.com/en-us/library/ms682411(VS.85).aspx</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a639bc4dc66a60fffc87b42ffd31f8404">  105</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a639bc4dc66a60fffc87b42ffd31f8404">encodeLockName</a>($name)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">return</span> str_replace(array(<span class="charliteral">&#39;%&#39;</span>, <span class="charliteral">&#39;\\&#39;</span>), array(<span class="stringliteral">&#39;%25&#39;</span>, <span class="stringliteral">&#39;%5C&#39;</span>), $name);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">     * Checks if the adapter meets its requirements.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a1eb7f71dfca79a73342b574954be49dc">  115</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a1eb7f71dfca79a73342b574954be49dc">isMeetingRequirements</a>()</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">return</span> extension_loaded(<span class="stringliteral">&#39;wincache&#39;</span>)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            &amp;&amp; version_compare(phpversion(<span class="stringliteral">&#39;wincache&#39;</span>), <span class="stringliteral">&#39;1.1.0&#39;</span>, <span class="stringliteral">&#39;&gt;=&#39;</span>)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            &amp;&amp; ini_get(<span class="stringliteral">&#39;wincache.ucenabled&#39;</span>)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            &amp;&amp; (<span class="stringliteral">&#39;cli&#39;</span> !== PHP_SAPI || ini_get(<span class="stringliteral">&#39;wincache.enablecli&#39;</span>));</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">     * Releases any locks obtained by this instance as soon as there are no more</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">     * references to the object&#39;s persistent ID.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a421831a265621325e1fdd19aace0c758">  127</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a421831a265621325e1fdd19aace0c758">__destruct</a>()</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span> (0 === --static::$requestInstances[$this-&gt;persistentId]) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordflow">foreach</span> (static::$locksBackup[$this-&gt;persistentId] as $key) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                wincache_unlock(</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    $this-&gt;persistentId . static::encodeLockName($key)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                );</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">     * Obtains a named lock.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">     * @param string $key     Name of the key to obtain. Note that $key may</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">     *     repeat for each distinct $persistentId.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">     * @param double $timeout Ignored with WinCache. Script will always block if</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">     *     the lock can&#39;t be immediately obtained.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ac2d0adeb40a4b61733c977c3ff3964f1">  149</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ac2d0adeb40a4b61733c977c3ff3964f1">lock</a>($key, $timeout = null)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        $result = wincache_lock(</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            $this-&gt;persistentId . static::encodeLockName($key)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        );</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">if</span> ($result) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            static::$locksBackup[$this-&gt;persistentId] = $key;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">return</span> $result;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">     * Releases a named lock.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">     * @param string $key Name of the key to release. Note that $key may</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">     *     repeat for each distinct $persistentId.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a6bd3c523641e7289837a91ce71f14a4e">  168</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a6bd3c523641e7289837a91ce71f14a4e">unlock</a>($key)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        $result = wincache_unlock(</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            $this-&gt;persistentId . static::encodeLockName($key)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        );</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span> ($result) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            unset(</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                static::$locksBackup[$this-&gt;persistentId][array_search(</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    $key,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                    static::$locksBackup[$this-&gt;persistentId],</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    <span class="keyword">true</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                )]</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            );</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">return</span> $result;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">     * Checks if a specified key is in the storage.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">     * @param string $key Name of key to check.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">     * @return bool TRUE if the key is in the storage, FALSE otherwise.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ace1ae5be37bf26c172cc7ea4e1a65e26">  192</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ace1ae5be37bf26c172cc7ea4e1a65e26">exists</a>($key)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">return</span> wincache_ucache_exists($this-&gt;persistentId . $key);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">     * Adds a value to the shared memory storage.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">     * Sets a value to the storage if it doesn&#39;t exist, or fails if it does.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">     * @param string $key   Name of key to associate the value with.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">     * @param mixed  $value Value for the specified key.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">     * @param int    $ttl   Seconds to store the value. If set to 0 indicates no</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">     *     time limit.</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a71580e22e09c0e013d322efe2a83ab23">  209</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a71580e22e09c0e013d322efe2a83ab23">add</a>($key, $value, $ttl = 0)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">return</span> wincache_ucache_add($this-&gt;persistentId . $key, $value, $ttl);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">     * Sets a value in the shared memory storage.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">     * Adds a value to the storage if it doesn&#39;t exist, overwrites it otherwise.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">     * @param string $key   Name of key to associate the value with.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">     * @param mixed  $value Value for the specified key.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">     * @param int    $ttl   Seconds to store the value. If set to 0 indicates no</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     *     time limit.</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a5f9750cc0fd027889ad037b5095a73c7">  226</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">set</span>($key, $value, $ttl = 0)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">return</span> wincache_ucache_set($this-&gt;persistentId . $key, $value, $ttl);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">     * Gets a value from the shared memory storage.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">     * Gets the current value, or throws an exception if it&#39;s not stored.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">     * @param string $key Name of key to get the value of.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">     * @return mixed The current value of the specified key.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a24a9bf83a1002d46ece83a93d14bd921">  240</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">get</span>($key)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        $value = wincache_ucache_get($this-&gt;persistentId . $key, $success);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">if</span> (!$success) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> SHM\InvalidArgumentException(</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="stringliteral">&#39;Unable to fetch key. No such key, or key has expired.&#39;</span>,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                300</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            );</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">return</span> $value;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">     * Deletes a value from the shared memory storage.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">     * @param string $key Name of key to delete.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#aa74a2edd6f3cbb5c5353f7faa97b6d70">  259</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">delete</span>($key)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span> wincache_ucache_delete($this-&gt;persistentId . $key);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">     * Increases a value from the shared memory storage.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">     * Increases a value from the shared memory storage. Unlike a plain</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">     * set($key, get($key)+$step) combination, this function also implicitly</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">     * performs locking.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">     * @param string $key  Name of key to increase.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">     * @param int    $step Value to increase the key by.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">     * @return int The new value.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a3403eeb19ee0687ec25f59c8b0502d20">  276</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a3403eeb19ee0687ec25f59c8b0502d20">inc</a>($key, $step = 1)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        $newValue = wincache_ucache_inc(</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            $this-&gt;persistentId . $key,</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            (<span class="keywordtype">int</span>) $step,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            $success</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        );</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">if</span> (!$success) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> SHM\InvalidArgumentException(</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="stringliteral">&#39;Unable to increase the value. Are you sure the value is int?&#39;</span>,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                301</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            );</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">return</span> $newValue;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">     * Decreases a value from the shared memory storage.</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">     * Decreases a value from the shared memory storage. Unlike a plain</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">     * set($key, get($key)-$step) combination, this function also implicitly</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">     * performs locking.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">     * @param string $key  Name of key to decrease.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">     * @param int    $step Value to decrease the key by.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     * @return int The new value.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ab2ffac52f23b37ce69e360823b398ba3">  304</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ab2ffac52f23b37ce69e360823b398ba3">dec</a>($key, $step = 1)</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        $newValue = wincache_ucache_dec(</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            $this-&gt;persistentId . $key,</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            (<span class="keywordtype">int</span>) $step,</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            $success</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        );</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span> (!$success) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> SHM\InvalidArgumentException(</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                <span class="stringliteral">&#39;Unable to decrease the value. Are you sure the value is int?&#39;</span>,</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                302</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            );</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">return</span> $newValue;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">     * Sets a new value if a key has a certain value.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">     * Sets a new value if a key has a certain value. This function only works</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">     * when $old and $new are longs.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">     * @param string $key Key of the value to compare and set.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">     * @param int    $old The value to compare the key against.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">     * @param int    $new The value to set the key to.</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">     * @return bool TRUE on success, FALSE on failure.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#afa053972d858857cacc1fff288325279">  332</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#afa053972d858857cacc1fff288325279">cas</a>($key, $old, $new)</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> wincache_ucache_cas($this-&gt;persistentId . $key, $old, $new);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">     * Clears the persistent storage.</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">     * Clears the persistent storage, i.e. removes all keys. Locks are left</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">     * intact.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">     * @return void</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#aa821bec12eaa7e0f649397c9675ff505">  345</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#aa821bec12eaa7e0f649397c9675ff505">clear</a>()</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        $info = wincache_ucache_info();</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">foreach</span> ($info[<span class="stringliteral">&#39;ucache_entries&#39;</span>] as $entry) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">if</span> (!$entry[<span class="stringliteral">&#39;is_session&#39;</span>]</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                &amp;&amp; 0 === strpos($entry[<span class="stringliteral">&#39;key_name&#39;</span>], $this-&gt;persistentId)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            ) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                wincache_ucache_delete($entry[<span class="stringliteral">&#39;key_name&#39;</span>]);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">     * Retrieve an external iterator</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">     * Returns an external iterator.</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">     * @param string|null $filter   A PCRE regular expression.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">     *     Only matching keys will be iterated over.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">     *     Setting this to NULL matches all keys of this instance.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">     * @param bool        $keysOnly Whether to return only the keys,</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">     *     or return both the keys and values.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">     * @return ArrayObject An array with all matching keys as array keys,</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">     *     and values as array values. If $keysOnly is TRUE, the array keys are</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">     *     numeric, and the array values are key names.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a121d369382d469f1f909a97a1de395c2">  372</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a121d369382d469f1f909a97a1de395c2">getIterator</a>($filter = null, $keysOnly = <span class="keyword">false</span>)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        $info = wincache_ucache_info();</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        $result = array();</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">foreach</span> ($info[<span class="stringliteral">&#39;ucache_entries&#39;</span>] as $entry) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">if</span> (!$entry[<span class="stringliteral">&#39;is_session&#39;</span>]</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                &amp;&amp; 0 === strpos($entry[<span class="stringliteral">&#39;key_name&#39;</span>], $this-&gt;persistentId)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            ) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                $localKey = strstr($entry[<span class="stringliteral">&#39;key_name&#39;</span>], $this-&gt;persistentId);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="keywordflow">if</span> (null === $filter || preg_match($filter, $localKey)) {</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    <span class="keywordflow">if</span> ($keysOnly) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                        $result[] = $localKey;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                        $result[$localKey] = apc_fetch($localKey);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                    }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="namespace_array_object.html">ArrayObject</a>($result);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div><div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a421831a265621325e1fdd19aace0c758"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a421831a265621325e1fdd19aace0c758">PEAR2\Cache\SHM\Adapter\Wincache\__destruct</a></div><div class="ttdeci">__destruct()</div><div class="ttdoc">Releases any locks obtained by this instance as soon as there are no more references to the object&amp;#39;s ...</div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00127">Wincache.php:127</a></div></div>
<div class="ttc" id="namespace_array_object_html"><div class="ttname"><a href="namespace_array_object.html">ArrayObject</a></div><div class="ttdoc">APC::getIterator() returns this object. </div></div>
<div class="ttc" id="namespace_p_e_a_r2_1_1_cache_1_1_s_h_m_html"><div class="ttname"><a href="namespace_p_e_a_r2_1_1_cache_1_1_s_h_m.html">PEAR2\Cache\SHM</a></div><div class="ttdoc">The namespace declaration. </div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a4d9651f3a7676b4ef084194bc310f7fb"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a4d9651f3a7676b4ef084194bc310f7fb">PEAR2\Cache\SHM\Adapter\Wincache\__construct</a></div><div class="ttdeci">__construct($persistentId)</div><div class="ttdoc">Creates a new shared memory storage. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00079">Wincache.php:79</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_html"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m.html">PEAR2\Cache\SHM</a></div><div class="ttdef"><b>Definition:</b> <a href="_s_h_m_8php_source.html#l00051">SHM.php:51</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a3403eeb19ee0687ec25f59c8b0502d20"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a3403eeb19ee0687ec25f59c8b0502d20">PEAR2\Cache\SHM\Adapter\Wincache\inc</a></div><div class="ttdeci">inc($key, $step=1)</div><div class="ttdoc">Increases a value from the shared memory storage. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00276">Wincache.php:276</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a6bd3c523641e7289837a91ce71f14a4e"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a6bd3c523641e7289837a91ce71f14a4e">PEAR2\Cache\SHM\Adapter\Wincache\unlock</a></div><div class="ttdeci">unlock($key)</div><div class="ttdoc">Releases a named lock. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00168">Wincache.php:168</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a639bc4dc66a60fffc87b42ffd31f8404"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a639bc4dc66a60fffc87b42ffd31f8404">PEAR2\Cache\SHM\Adapter\Wincache\encodeLockName</a></div><div class="ttdeci">static encodeLockName($name)</div><div class="ttdoc">Encodes a lock name. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00105">Wincache.php:105</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a71580e22e09c0e013d322efe2a83ab23"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a71580e22e09c0e013d322efe2a83ab23">PEAR2\Cache\SHM\Adapter\Wincache\add</a></div><div class="ttdeci">add($key, $value, $ttl=0)</div><div class="ttdoc">Adds a value to the shared memory storage. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00209">Wincache.php:209</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_afa053972d858857cacc1fff288325279"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#afa053972d858857cacc1fff288325279">PEAR2\Cache\SHM\Adapter\Wincache\cas</a></div><div class="ttdeci">cas($key, $old, $new)</div><div class="ttdoc">Sets a new value if a key has a certain value. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00332">Wincache.php:332</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_aa821bec12eaa7e0f649397c9675ff505"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#aa821bec12eaa7e0f649397c9675ff505">PEAR2\Cache\SHM\Adapter\Wincache\clear</a></div><div class="ttdeci">clear()</div><div class="ttdoc">Clears the persistent storage. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00345">Wincache.php:345</a></div></div>
<div class="ttc" id="namespace_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_html"><div class="ttname"><a href="namespace_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter.html">PEAR2\Cache\SHM\Adapter</a></div><div class="ttdoc">The namespace declaration. </div><div class="ttdef"><b>Definition:</b> <a href="_a_p_c_8php_source.html#l00022">APC.php:22</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html">PEAR2\Cache\SHM\Adapter\Wincache</a></div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00043">Wincache.php:43</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a121d369382d469f1f909a97a1de395c2"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a121d369382d469f1f909a97a1de395c2">PEAR2\Cache\SHM\Adapter\Wincache\getIterator</a></div><div class="ttdeci">getIterator($filter=null, $keysOnly=false)</div><div class="ttdoc">Retrieve an external iterator. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00372">Wincache.php:372</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_ab2ffac52f23b37ce69e360823b398ba3"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ab2ffac52f23b37ce69e360823b398ba3">PEAR2\Cache\SHM\Adapter\Wincache\dec</a></div><div class="ttdeci">dec($key, $step=1)</div><div class="ttdoc">Decreases a value from the shared memory storage. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00304">Wincache.php:304</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_a1eb7f71dfca79a73342b574954be49dc"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#a1eb7f71dfca79a73342b574954be49dc">PEAR2\Cache\SHM\Adapter\Wincache\isMeetingRequirements</a></div><div class="ttdeci">static isMeetingRequirements()</div><div class="ttdoc">Checks if the adapter meets its requirements. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00115">Wincache.php:115</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_ac2d0adeb40a4b61733c977c3ff3964f1"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ac2d0adeb40a4b61733c977c3ff3964f1">PEAR2\Cache\SHM\Adapter\Wincache\lock</a></div><div class="ttdeci">lock($key, $timeout=null)</div><div class="ttdoc">Obtains a named lock. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00149">Wincache.php:149</a></div></div>
<div class="ttc" id="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache_html_ace1ae5be37bf26c172cc7ea4e1a65e26"><div class="ttname"><a href="class_p_e_a_r2_1_1_cache_1_1_s_h_m_1_1_adapter_1_1_wincache.html#ace1ae5be37bf26c172cc7ea4e1a65e26">PEAR2\Cache\SHM\Adapter\Wincache\exists</a></div><div class="ttdeci">exists($key)</div><div class="ttdoc">Checks if a specified key is in the storage. </div><div class="ttdef"><b>Definition:</b> <a href="_wincache_8php_source.html#l00192">Wincache.php:192</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d04e140f9465157625d435669917c5a2.html">PEAR2</a></li><li class="navelem"><a class="el" href="dir_a5dfbd1bd1804e80558bd87f5a13ecf8.html">Cache</a></li><li class="navelem"><a class="el" href="dir_c1e575c96c296d3a5c99024962dac7fc.html">SHM</a></li><li class="navelem"><a class="el" href="dir_016b335b54f68b01e85c25cb8ad459dd.html">Adapter</a></li><li class="navelem"><b>Wincache.php</b></li>
    <li class="footer">Generated on Mon Nov 7 2016 05:00:30 for PEAR2_Cache_SHM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
